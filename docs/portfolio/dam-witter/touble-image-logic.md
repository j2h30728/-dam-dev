---
sidebar_position: 3
---

# 이미지 업로드 로직 변경

## 변경 이유

### 변경 전 이미지 업로드 로직

1. 사용자가 게시글 등록 및 프로필 변경 페이지에 진입한다.
2. 사용자가 이미지를 선택하면 프리뷰 이미지를 보여준다.
3. 폼 작성을완료 하고 등록하기/변겨경하기 버튼을 클릭한다.
4. cloudflare image 에 이미지를 등록한 후, imageId를 얻는다.
5. 사용자가 작성한 글과 함께 imageId를 데이터베이스에 등록한다.
6. 등록이 완료될 떄까지 사용자에게 로딩 상태를 표시해준다.

사용자는 작성완료 버튼을 클릭하고 난 후,4~5번의 단계가 순차적으로 진행완료 될 떄까지 사용자는 대기를 해야합니다.

당시, 이유를 알 수 없는 API 요청응답이 무척 느리기 떄문에 **최대한 사용자 대기시간을 줄여야 한다는 것으로 결론을 내렸습니다.**

> 데이터 베이스의 리전이 미국으로 되어있었기 때문에 모든 API 요청 및 응답이 느렸었습니다.
> 가까운 리전으로 변경 완료
>
> [-> 자세한 내용 확인 하기](./trouble-database-region.md)

### 변경 후

사용자가 이미지를 선택하고 **프리뷰 이미지 로 등록될 때, 미리 ImageId를 받아오는 형식**으로 변경합니다.

1. 사용자가 게시글 등록 및 프로필 변경 페이지에 진입한다.
2. 사용자가 이미지를 선택한다
   - 선택한 이미지는 프리뷰 이미지로 사용자에게 보여준다.
   - 선택한 이미지를 바로 cloudflare에 등록하여 imageId를 받아온다.
3. 폼 작성을완료 하고 등록하기/변겨경하기 버튼을 클릭한다.
4. 이미 이미지를 등록하여 받은 ImageId값과 폼 내용과 함께 데이터베이스에 등록 요청한다.
5. 등록이 완료될 떄까지 사용자에게 로딩 상태를 표시해준다.

사용자는 작성완료 버튼을 클릭하고 난 후,4번의 단계만 진행완료 될 떄까지 대기하므로 대기시간이 줄어듭니다.

| 변경 전                                                                                   | 변경 후                                                                                   |
| ----------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- |
| ![image](https://github.com/user-attachments/assets/7dc4e0b8-5a05-4e8c-b1ac-1ad3b0de79c0) | ![image](https://github.com/user-attachments/assets/11bdf9c8-7322-4411-ae8b-0746e3b07557) |

---

- [관련 풀리퀘스트](https://github.com/j2h30728/dam-witter/pull/3)
